<!DOCTYPE html>
<title>highlighter</title>
<link href="prism.css" rel="stylesheet" />

<p>From <a href="https://prismjs.com/index.html">Prism.js</a> and
  <a href="https://prismjs.com/test.html">its test page</a>.</p>

<p>
  <textarea placeholder="Type some code here">&lt;div class="entry">
  &lt;h1>{{title}}&lt;/h1>
  &lt;div class="body">
    {{body}}
  &lt;/div>
&lt;/div></textarea>
</p>

<p>Result (click to copy):</p>
<input type=checkbox id=lightdark name=lightdark><label for=lightdark> Switch light/dark</label>
<div id="precontainer"><pre><code></code></pre></div>

<p id="language">
  <strong>Language (see list of <a
    href="https://prismjs.com/index.html#supported-languages">supported
    languages</a>):</strong>
  <input name="lang" value="handlebars">
</p>

<p id="language">
  <strong>Size:</strong>
  <input type="number" name="size" min=1 value="24">
</p>

<script src="lib/prism.js"></script>
<script>
  const input = document.querySelector('textarea');
  const lang = document.querySelector('input[name=lang]');
  const output = document.querySelector('pre > code');
  const pre = document.querySelector('pre');
  const precontainer = document.querySelector('#precontainer');
  const size = document.querySelector('input[name=size]');
  const lightdark = document.querySelector('#lightdark');

  restoreStorage();

  input.addEventListener('input', doHighlight);
  lang.addEventListener('change', doHighlight);
  size.addEventListener('change', doHighlight);
  lang.addEventListener('change', saveStorage);
  size.addEventListener('change', saveStorage);
  lightdark.addEventListener('input', saveStorage);

  doHighlight();
  input.select();

  pre.addEventListener('click', doSelect);

  function restoreStorage() {
    if (localStorage.lastHighlighterLanguage) {
      lang.value = localStorage.lastHighlighterLanguage;
    }

    if (localStorage.lastHighlighterSize) {
      size.value = localStorage.lastHighlighterSize;
    }

    if (localStorage.lastHighlighterLightdark) {
      lightdark.checked = localStorage.lastHighlighterLightdark === 'true';
    }
  }

  function saveStorage() {
    localStorage.lastHighlighterLanguage = lang.value;
    localStorage.lastHighlighterSize = size.value;
    localStorage.lastHighlighterLightdark = lightdark.checked;
  }

  function doHighlight() {
    output.textContent = input.value.trim() + '\nÂ ';
    output.className = `language-${lang.value}`;
    Prism.highlightElement(output);
    precontainer.style.setProperty('--font-size', size.value + 'pt');
  }

  function doSelect() {
    const selection = window.getSelection();
    const range = document.createRange();
    range.selectNodeContents(output);
    selection.removeAllRanges();
    selection.addRange(range);
    document.execCommand("copy");
    setTimeout(() => input.select(), 300);
  }
</script>
